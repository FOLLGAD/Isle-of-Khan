<!DOCTYPE html>
<html>
  <head>
    <title>Isle of Khan</title>
    <meta charset="UTF-8">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="resources/favicon.png" />
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />
    <!-- JQuery Custom Scrollbar -->
    <link rel="stylesheet" type="text/css" href="css/jquery.mCustomScrollbar.min.css" />
    <!-- Image Picker (JQuery Plugin) -->
    <link rel="stylesheet" type="text/css" href="css/image-picker.css" />
    <!-- Main CSS -->
    <link rel="stylesheet" type="text/css" href="css/source.css" />
  </head>
  <body oncontextmenu="return false;">
    <div id="container">
      <div id="menu-screen">
        <div id="menu-overlay" class="container" style="padding-top:50px">
          <div class="row">
            <div class="col-sm-3">
              <div id="right-column" class="" style="background-color:black">Hello</div>
            </div>
            <div class="col-sm-6">
              <div id="main-column" class="text-center">
                <h1>Isle of Khan</h1>
                <hr />
                <div class="form-group">
                    <form id="registration" action="">
                      <input style="padding: 5px;" id="username" name="username" type="text" autofocus="true" placeholder="Enter nickname">
                      <h1>Select a class</h1>
                      <div class="row">
                        <div class="col-xs-4 class-select" id="class-archer">
                          <img src="resources/archer-menu.png" />
                          <h1>Archer</h1>
                        </div>
                        <div class="col-xs-4 class-select" id="class-warrior">
                          <img src="resources/warrior-menu.png" />
                          <h1>Warrior</h1>
                        </div>
                        <div class="col-xs-4 class-select" id="class-mage">
                          <img src="resources/warrior-menu.png" />
                          <h1>Mage</h1>
                        </div>
                      </div>
                      <br><button class="btn btn-default">Play</button>
                    </form>
                </div>
              </div> <!-- ./main column -->
            </div>
            <div class="col-sm-3">
              <div id="left-column" style="background-color:black">Hello</div>
            </div>
          </div> <!-- ./row -->
        </div><!-- ./menu overlay [Absolute]-->
      </div><!-- ./menu-screen [Relative]-->
      <div id="game-overlay">
        <div id="chat-window" style="display:none">
          <div id="chatmessages" class="mCustomScrollbar" data-mcs-theme="light" data-mcs-axis="y">
          <!--<div id="chatmessages">-->
            <ul id="messagelist">
            </ul>
          </div>
          <form id="chat-form" action="" autocomplete="off">
            <input id="chat-bar" type="text" placeholder="Enter a chat message" autocomplete="off">
            <input id="chat-submit" type="hidden">
          </form>
        </div>
        <canvas id="canvas" class="game-canvas" tabindex="1"></canvas>
        <canvas id="minimap" class="game-canvas" tabindex="1"></canvas>
        <div id="scoreboard" style="display:none">
          <h1>Scoreboard</h1>
          <table id="scoreboard-players" class="table">
          </table>
        </div>
        <div id="death-messages">
        </div>
      </div>
    </div>
  </body>
  <!-- JQuery -->
  <script src="js/jquery-3.1.1.min.js"></script>
  <!-- Image Picker (JQuery Plugin) -->
  <script src="js/image-picker.min.js"></script>
  <!-- JQuery Custom Scrollbar -->
  <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <!-- Socket.io -->
  <script src="/socket.io/socket.io.js"></script>
  <!-- Emits and Recieves -->
  <script src="game/sockets.js"></script>
  <!-- Base game client -->
  <script src="/client.js"></script>
  <script>
  //Disables selection
  $(document).bind('selectstart dragstart', function(e) {
    e.preventDefault();
    return false;
  });
  //Selects class
  var gameClass;
  $("#class-archer").click(function () {
    gameClass = "archer";
  });
  $("#class-warrior").click(function () {
    gameClass = "warrior";
  });
  $("#class-mage").click(function () {
    gameClass = "mage";
  });
  //Handles registration
  $("#registration").submit(function (e) {
    e.preventDefault();
    username = $('#username').val();
    register(username, gameClass);
    $('#menu-screen').fadeOut('slow', function(){ $('#menu-screen').remove();
     });
    $("#chat-window").show();
    $('#canvas').focus();
  });
  $(document).keydown(function (objEvent) {
    if (objEvent.key == 'Tab') {  // tab pressed
      objEvent.preventDefault(); // prevents tab from getting pressed
    }
  })
  //Focuses chat
  $(document).keypress(function(e) {
    var key = e.which;
    if (key == 13) { // If enter is pressed
      if (!$('#chat-bar').is(":focus")){
        $('#chat-bar').focus();
        $('#chat-window').css('-webkit-user-select', 'all');
        $('#chat-window').css('-moz-user-select', 'all');
        $('#chat-window').css('-khtml-user-select', 'all');
        $('#chat-window').css('-ms-user-select', 'all');
        $('#chat-window').css('user-select', 'all');
      }else{
        $('#canvas').focus();
      }
    }
  });
  //Sends a chat message
  $("#chat-form").submit( function(e) {
    e.preventDefault();
      if (!!$("#chat-bar").val().replace(/\s/g, '').length) {
        socket.emit('chat-msg', $("#chat-bar").val());
      }
      $("#chat-bar").val("");
      return true;
  });
    //Adds chat messages
    socket.on('chat-msg', function (msg, sender, date) {
      $("#messagelist").append($("<li>").text("<"+ sender + "> " + msg));
      $("#chatmessages").mCustomScrollbar('scrollTo','bottom'); //Scrolls to bottom when message is recieved
    });
  </script>
</html>
